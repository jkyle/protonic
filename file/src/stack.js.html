<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/stack.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/jkyle/protonic.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/funnel.js~Funnel.html">Funnel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stack.js~Stack.html">Stack</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/stream.js~Stream.html">Stream</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/view.js~View.html">View</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/stack.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/** Requires Immutable */
import Immutable from &apos;immutable&apos;;

/**
 * A Stack isn&apos;t a stream, but can be used in conjunction with streams, actions, and
 * transformers to make debugging much easier.
 */
class Stack {
  constructor (size = 20, debug = false) {
    this.stack = Immutable.List().setSize(size);
    this.debug = debug;
  }

  addToStack (item) {
    if (this.debug) {
      this.stack = this.stack.shift().push(item);
    }
  }

  pushAction (fn, args) {
    this.addToStack(Immutable.Map({type: &apos;ACTION&apos;, name: fn, args: args}));
  }

  pushState (name, state, streamType) {
    this.addToStack(Immutable.Map({ type: &apos;STATE&apos;, name , state, streamType }));
    if (this.testFn &amp;&amp; this.testFn(state)) {
      this.dumpWhenCb(this.dump());
    }
  }

  pushTransformer (fn, args) {
    this.addToStack(Immutable.Map({ type: &apos;TRANSFORMER&apos;, name: fn, args: args}));
  }

  pushLog (text) {
    this.addToStack(Immutable.Map({ type: &apos;LOG&apos;, text }));
  }

  dump () {
    return this.stack.filter(item =&gt; item);
  }

  dumpWhen (testFn, dumpFn) {
    this.testFn = testFn;
    this.dumpWhenCb = dumpFn;
  }

  dumpToLog (stateAccessor) {
    const toLog = {
      ACTION: item =&gt; console.log(&apos;%cACTION &apos; + &apos;%c&apos;+item.get(&apos;name&apos;) + &apos;\n&apos;,
                                  &apos;font-weight: bold; color: #629456&apos;, &apos;font-style: italic; color: #004&apos;,
                                  item.get(&apos;args&apos;)),
      LOG: item =&gt; console.log(&apos;%cLOG\n&apos; + item.get(&apos;text&apos;), &apos;background: #eee; color: #555&apos;),
      TRANSFORMER: item =&gt; console.log(&apos;%cTRANSFORMER &apos; + &apos;%c&apos; + item.get(&apos;name&apos;) + &apos;\n&apos;,
                                       &apos;font-weight: bold; color: #D08A10&apos;, &apos;font-style: italic; color: #004&apos;,
                                       item.get(&apos;args&apos;)),
      STATE: (item, stateAccessor = []) =&gt; console.log(&apos;%cSTATE &apos; + (item.streamType ? &apos;(&apos; + item.streamType + &apos;)&apos; : &apos;&apos;) + &apos;%c&apos; + item.get(&apos;name&apos;) + &apos;\n&apos;,
                                            &apos;font-weight: bold; color: #3B74C4&apos;, &apos;font-style: italic; color: #004&apos;,
                                            item.getIn([&apos;state&apos;].concat(stateAccessor)).toJS())
    };

    if (this.debug) {
      this.stack.map(item =&gt; {
        if(item){
          toLog[item.get(&apos;type&apos;)](item, stateAccessor);
        }
      });
    }
  }

  set size(newSize) {
    this.stack.setSize(newSize);
  }

  get size() {
    return this.stack.size;
  }
}

export default Stack;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.7)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
