<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: stack.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: stack.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module stack
 */

/** Requires Immutable */
import Immutable from 'immutable';

/**
 * A Stack isn't a stream, but can be used in conjunction with streams, actions, and
 * transformers to make debugging much easier.
 */
class Stack {
  constructor (size = 20, debug = false) {
    this.stack = Immutable.List().setSize(size);
    this.debug = debug;
  }

  addToStack (item) {
    if (this.debug) {
      this.stack = this.stack.shift().push(item);
    }
  }

  pushAction (fn, args) {
    this.addToStack(Immutable.Map({type: 'ACTION', name: fn, args: args}));
  }

  pushState (name, state, streamType) {
    this.addToStack(Immutable.Map({ type: 'STATE', name , state, streamType }));
    if (this.testFn &amp;&amp; this.testFn(state)) {
      this.dumpWhenCb(this.dump());
    }
  }

  pushTransformer (fn, args) {
    this.addToStack(Immutable.Map({ type: 'TRANSFORMER', name: fn, args: args}));
  }

  pushLog (text) {
    this.addToStack(Immutable.Map({ type: 'LOG', text }));
  }

  dump () {
    return this.stack.filter(item => item);
  }

  dumpWhen (testFn, dumpFn) {
    this.testFn = testFn;
    this.dumpWhenCb = dumpFn;
  }

  dumpToLog (stateAccessor) {
    const toLog = {
      ACTION: item => console.log('%cACTION ' + '%c'+item.get('name') + '\n',
                                  'font-weight: bold; color: #629456', 'font-style: italic; color: #004',
                                  item.get('args')),
      LOG: item => console.log('%cLOG\n' + item.get('text'), 'background: #eee; color: #555'),
      TRANSFORMER: item => console.log('%cTRANSFORMER ' + '%c' + item.get('name') + '\n',
                                       'font-weight: bold; color: #D08A10', 'font-style: italic; color: #004',
                                       item.get('args')),
      STATE: (item, stateAccessor = []) => console.log('%cSTATE ' + (item.streamType ? '(' + item.streamType + ')' : '') + '%c' + item.get('name') + '\n',
                                            'font-weight: bold; color: #3B74C4', 'font-style: italic; color: #004',
                                            item.getIn(['state'].concat(stateAccessor)).toJS())
    }

    if (this.debug) {
      this.stack.map((item, index) => {
        if(item){
          toLog[item.get('type')](item, stateAccessor);
        }
      });
    }
  }

  set size(newSize) {
    this.stack.setSize(newSize);
  }

  get size() {
    return this.stack.size;
  }
}

export default Stack;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-funnel.html">funnel</a></li><li><a href="module-stack.html">stack</a></li><li><a href="module-stream.html">stream</a></li><li><a href="module-view.html">view</a></li></ul><h3>Classes</h3><ul><li><a href="module-funnel-Funnel.html">Funnel</a></li><li><a href="module-stack-Stack.html">Stack</a></li><li><a href="module-stream-Stream.html">Stream</a></li><li><a href="module-view-View.html">View</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Jun 28 2016 21:12:01 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
